language: java
jdk: oraclejdk8
sudo: required
branches:
  only:
  - master
  - "/.*-[0-9]+\\..*/"
  
before_script:
 - "export DISPLAY=:99.0"
 - "sh -e /etc/init.d/xvfb start"

install: true
script: 
#!/usr/bin/env sh
- set -e
 
# Define some variables 
- export IJ_PATH="$HOME/Fiji.app"
- export URL="http://sites.imagej.net/$UPDATE_SITE/"
- export IJ_LAUNCHER="$IJ_PATH/ImageJ-linux64"
- export PATH="$IJ_PATH:$PATH"
 
# Install ImageJ
- mkdir -p $IJ_PATH/
- cd $HOME/
- wget --no-check-certificate https://downloads.imagej.net/fiji/latest/fiji-linux64.zip
- unzip fiji-linux64.zip
- cd $TRAVIS_BUILD_DIR/
- sudo apt-get install realpath
- realpath $TRAVIS_BUILD_DIR/ExampleImage
- ls -l
- cd ..
- ls -l
- cd ..
- ls -l
- cd ..
- ls -l
 
# Install the package
#- unzip $TRAVIS_BUILD_DIR/Cluster_Analysis.zip -d $HOME/Fiji.app/plugins
#- cd $HOME/Fiji.app/plugins/
#- ls -l
- mv $TRAVIS_BUILD_DIR/Cluster_Analysis_BETA_v21.py $HOME/Fiji.app/plugins/
- mv $TRAVIS_BUILD_DIR/ExampleImage/ini.cfg $HOME/Fiji.app/plugins
- mv $TRAVIS_BUILD_DIR/sqlite-jdbc-3.21.0.jar $HOME/Fiji.app/plugins/
- $HOME/Fiji.app/ImageJ-linux64 --ij2 --headless --run $HOME/Fiji.app/plugins/Cluster_Analysis_BETA_v21.py 'expath="/home/travis/build/dcolam/Cluster-Analysis-Plugin/ExampleImage",headless="True",measure="False"'
#- xvfb-run -a $HOME/Fiji.app/ImageJ-linux64 --headless $HOME/Fiji.app/plugins/Cluster_Analysis.py "/home/travis/build/dcolam/Cluster-Analysis-Plugin/ExampleImage"
#- xvfb-run -a $HOME/Fiji.app/ImageJ-linux64 --ij2 --run $HOME/Fiji.app/plugins/Cluster_Analysis_travis_Tester.py 'filepath="/home/travis/build/dcolam/Cluster-Analysis-Plugin/ExampleImage"'
#- $HOME/Fiji.app/ImageJ-linux64 --ij2 --headless --macro $HOME/Fiji.app/plugins/Cluster_Analysis.py 'file="/home/travis/build/dcolam/Cluster-Analysis-Plugin/ExampleImage"'
#- export DISPLAY=:1
#- Xvfb $DISPLAY -auth /dev/null &
#- (
# the '(' starts a new sub shell. In this sub shell we start the worker processes:

#- $HOME/Fiji.app/ImageJ-linux64 --run $HOME/Fiji.app/plugins/Cluster_Analysis.py '"/home/travis/build/dcolam/Cluster-Analysis-Plugin/ExampleImage"' # running the actual ijm script
 
#- wait # waits until all 'program' processes are finished
# this wait sees only the 'program' processes, not the Xvfb process
#- )


